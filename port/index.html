 <!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css(.) styles/vendor.css -->
    <!-- bower:css -->
    <link rel="stylesheet" href="bootstrap.css" />
    <!-- endbower -->
    <!-- endbuild -->
    
    <!-- build:css(.tmp) styles/main.css -->
    <link rel="stylesheet" href="main.css">
    <!--
    <link rel="stylesheet" href="styles/sb-admin-2.css">
    <link rel="stylesheet" href="styles/timeline.css">
  -->
    <link rel="stylesheet" href="bower_components/metisMenu/dist/metisMenu.min.css">
    <link rel="stylesheet" href="bower_components/angular-loading-bar/build/loading-bar.min.css">
    <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css" type="text/css">
    <!-- endbuild -->
    
    <!-- build:js(.) scripts/vendor.js -->
    <!-- bower:js -->
    <!--
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
  -->
  <!--
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
  -->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/angular/angular.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="bower_components/angular-ui-router/release/angular-ui-router.min.js"></script>
    <script src="bower_components/json3/lib/json3.min.js"></script>
    <script src="bower_components/oclazyload/dist/ocLazyLoad.min.js"></script>
    <script src="bower_components/angular-loading-bar/build/loading-bar.min.js"></script>
    <script src="bower_components/angular-bootstrap/ui-bootstrap-tpls.min.js"></script>
    <script src="bower_components/metisMenu/dist/metisMenu.min.js"></script>
    <script src="bower_components/Chart.js/Chart.min.js"></script>
    <script type="text/javascript" src="bower_components/angular-weather/src/angular-weather.js"></script>
    <script src= "https://cdn.zingchart.com/zingchart.min.js"></script>
    <script> zingchart.MODULESDIR = "https://cdn.zingchart.com/modules/";  
             ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9","ee6b7db5b51705a13dc2339db3edaf6d"];</script>
    <script src="bower_components/justgage/justgage.js"></script>


    <!-- gauge -->

  <script src="http://code.highcharts.com/highcharts.js"></script>
  <script src="http://code.highcharts.com/highcharts-more.js"></script>
  <script src="http://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/solid-gauge.js"></script>



    <!-- endbower -->
    <!-- endbuild -->
    
    <!-- build:js({.tmp,app}) scripts/scripts.js -->
        <script src="app.js"></script>
        <!--
        <script src="js/sb-admin-2.js"></script>
      -->
    <!-- endbuild -->



    <!-- Custom CSS -->
        <style>
h3 {
  font-size: 2.5vh;

  
}
img{
  height: 15vh;
}
img2{
  height: 15vh;
  float: left;
}
 h1{
     color: white;
 }

</style>

    <!-- Custom Fonts -->

    <!-- Morris Charts CSS -->
    <!-- <link href="styles/morrisjs/morris.css" rel="stylesheet"> -->

      <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>




    </head>
   
<body background="img/nature.jpg" >

<font face="Georgia"> <div class = "outside">
<div class="row">
    <div class="col-lg-12">
        <h1 id="title">Solar Energy Dashboard</h1>
    </div>
</div>
<div class="row">
    <div class="col-lg-4 col-sm-12" id="line-chart" ng-controller="ChartCtrl">
        <div class="panel panel-default">
            <div class="panel-heading">Building Solar Energy %</div>
            <div class="panel-body">
               <div   id="gauge" style="min-width: 310px; max-width: 4000px; height: 27vh; margin: 0 auto"></div>
            </div>
        </div>
    </div>
    <div class="col-lg-4 col-sm-12" id="bar-chart" ng-controller="ChartCtrl">
        <div class="panel panel-default">
            <div class="panel-heading" id="demo">Energy Analogy</div>
            <div class="panel-body">
                 <div class = "fixedT">
                  <center><img src="img/idea.png" >
                  <h3 id="enAnalogy"> You could power 10 lightbulbs for a day with the energy produced by these solar panels </h3></center>
            </div>
            </div>
        </div>
    </div>
        <div class="col-lg-4 col-sm-12" id="doughnut-chart" ng-controller="ChartCtrl">
        <div class="panel panel-default">
            <div class="panel-heading">Dollars Saved</div>
            <div class="panel-body">
            <div class = "fixedT">
               <center><img src="img/banknote.png" >
                <h3 id="cost"> $10,000 of energy was produced in the last month </h3></center>
            </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-8 col-sm-12" id="radar-chart" ng-controller="ChartCtrl">
        <div class="panel panel-default" >
            <div class="panel-heading">Energy Chart</div>
            <div class="panel-body" style = "height: 100%;">
                <div id="chart_div" style = "height: 33vh;"></div>
            </div>
        </div>
    </div>
    <div class="col-lg-4 col-sm-12" id="pie-chart" ng-controller="ChartCtrl">
        <div class="panel panel-default">
          <div class="panel-heading">Weather</div>
          <div class="panel-body">
             <div id="weatherPanel" class = "fixed">      
                <b>Madison</b>
                <hr color="black" style="height:.7vh; margin-top: 1vh;">
                <center>
                <div class="weather">
                    <p id="weatherTemp" style="font-size: 8vh;" >   </p>
                </div>
                <div id="weatherPic" class ="weather">
                </div>
                </center>
            </div>
          </div>
        </div>
    </div>
    <div class="component__weather-box"></div>
  </div>
</font>

<!--Buttons to change timeframe  CHANGE TO DROPDOWN MENU FOR FINAL ITERATION-->
<button onclick="changer('https://api.myjson.com/bins/yishj')">change to week data</button>
<button onclick="changer('https://api.myjson.com/bins/7no1v')">change to month data</button>
<button onclick="changer('https://api.myjson.com/bins/pxobn')">change to year data</button>

<p style=" color: white;">Timescale: </p>
<p style=" color: white;" id="timescaleTest">showing timescale</p>
<p style=" color: white;">Query URL:</p>
<p style=" color: white;" id="queryTest">showing query url</p>


<script>

//keeping track of testing values:
var timescale;
var weatherIdTest;
//var urlInit = "";
var urlBase = "http://urlBase.com/?timescale=";
var firstStatement = "You could power ";
var secondStatement = " lightbulbs for a day with the energy produced by these solar panels in a week";

////////////////  
//energy gauge//
//////////////// 

//options
var gaugeOptions = {

    chart: {
        type: 'solidgauge'
    },

    title: null,

    pane: {
        center: ['50%', '90%'],
        size: '180%',
        startAngle: -90,
        endAngle: 90,
        background: {
            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || '#EEE',
            innerRadius: '60%',
            outerRadius: '100%',
            shape: 'arc'
        }
    },

    tooltip: {
      valueSuffix: '% energy'
      },

    // the value axis
    yAxis: {
        stops: [
            [0.1, '#DF5353'], // red
            [0.5, '#DDDF0D'], // yellow
            [0.9, '#55BF3B'] // greem
        ],
        lineWidth: 0,
        minorTickInterval: null,
        tickAmount: 2,
        title: {
            y: -70
        },
        labels: {
            y: 16
        }
    },

    plotOptions: {
        solidgauge: {
            dataLabels: {
                y: 5,
                borderWidth: 0,
                useHTML: true
            }
        }
    }
};

// function to create energy gauge
function drawGauge(energyLevel){
var chartSpeed = Highcharts.chart('gauge', Highcharts.merge(gaugeOptions, {
    yAxis: {
        min: 0,
        max: 20,
        title: {
            text: ''
        }
    },

    credits: {
        enabled: false
    },

    series: [{
        name: 'percentage',
        data: [energyLevel],
        dataLabels: {
            format: '<div style="text-align:center"><span style="font-size:25px;color:' +
                ((Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black') + '">{y}</span><br/>' +
                   '<span style="font-size:12px;color:silver">% energy</span></div>'
        },
        tooltip: {
            valueSuffix: '% energy'
        }
    }]

}));
}


//////////////////////////////
//draw google chart function//
//////////////////////////////
//create trigger to resizeEnd event     
$(window).resize(function() {
    if(this.resizeTO) clearTimeout(this.resizeTO);
    this.resizeTO = setTimeout(function() {
        $(this).trigger('resizeEnd');
    }, 50);
});

    google.charts.load('current', {packages: ['corechart', 'bar']});
    google.charts.setOnLoadCallback(drawBasic);

    function drawBasic() {
      var data = new google.visualization.arrayToDataTable(weekChart);

      var options = {
        legend: { position: "none" },
        hAxis : {textColor: '#ffffff'}
       };

      var chart = new google.charts.Bar(
        document.getElementById('chart_div'));
        
$(window).on('resizeEnd', function() {
      chart.draw(data, options);
      });
    }

function drawChart(timeChart){
    var data = new google.visualization.arrayToDataTable(timeChart);

      var options = {
        legend: { position: "none" },
        hAxis : {textColor: '#ffffff'}
       };

      var chart = new google.charts.Bar(
        document.getElementById('chart_div'));

      chart.draw(data, options);
}

/////////////////////////////////////////////
//drawing gauge and google chart on startup//
/////////////////////////////////////////////
window.onload = function(){

  //changer(urlInit);
  //grab('https://api.myjson.com/bins/ui45j');
  grab('https://api.myjson.com/bins/12xed3');

  weatherAPItest('http://api.openweathermap.org/data/2.5/weather?q=Madison&APPID=c8b07290a27f02e96c2277779d1591bd&units=imperial');

};

/////////////////////////////////////////////////////////////////
//updating every 10 seconds (change later 10min)  ////////////////
/////////////////////////////////////////////////////////////////
function repeatUpdate() {
    weatherAPItest('http://api.openweathermap.org/data/2.5/weather?q=Madison&APPID=c8b07290a27f02e96c2277779d1591bd&units=imperial');

    //changer(urlBase + timescale);
    if(timescale == "week")
        changer('https://api.myjson.com/bins/yishj');
    else if(timescale == "month")
        changer('https://api.myjson.com/bins/7no1v');
    else if(timescale == "year")
        changer('https://api.myjson.com/bins/pxobn');
}

var i = setInterval(function() { repeatUpdate(); }, 20000);

////////////////////////////////////////
//chart data for week, month, and year//
////////////////////////////////////////

    var weekChart = [
         ['', 'Value'],
         ['Sunday', 8.94],         
         ['Monday', 10.49],           
         ['Tuesday', 19.30],
         ['Wednesday', 19.30],
         ['Thursday', 19.30],
         ['Friday', 19.30],
         ['Saturday', 29.30],
      ];

      var monthChart =[
         ['', 'Value'],
         ['1', 8.94],         
         ['2', 10.49],           
         ['3', 19.30],
         ['4', 19.30],
         ['5', 19.30],
         ['6', 19.30],
         ['7', 29.30],
         ['8', 9.30],
         ['9', 19.30],
         ['10', 19.30],
         ['11', 8.94],         
         ['12', 10.49],           
         ['13', 19.30],
         ['14', 19.30],
         ['15', 19.30],
         ['16', 19.30],
         ['17', 29.30],
         ['18', 9.30],
         ['19', 19.30],
         ['20', 19.30],
         ['21', 8.94],         
         ['22', 10.49],           
         ['23', 19.30],
         ['24', 19.30],
         ['25', 19.30],
         ['26', 19.30],
         ['27', 29.30],
         ['28', 9.30],
         ['29', 19.30],
         ['30', 19.30],
         ['31', 55],
        ];

      var yearChart =[
         ['', 'Value'],
         ['Jan', 8.94],         
         ['Feb', 10.49],           
         ['Mar', 19.30],
         ['Apr', 19.30],
         ['May', 19.30],
         ['Jun', 19.30],
         ['Jul', 29.30],
         ['Aug', 9.30],
         ['Sep', 19.30],
         ['Oct', 19.30],
         ['Nov', 29.30],
         ['Dec', 9.30],
        ];



///////////////////////////////////////////////////
//Changer function (stupid name, rename later)  //
//use ajax to get data and decide timefrime      //
///////////////////////////////////////////////////

    function grab(url){
        var ourRequest = new XMLHttpRequest();
        ourRequest.open('GET', url);
        ourRequest.onload = function() {
            var ourData = JSON.parse(ourRequest.responseText);
            console.log(ourData);
            renderHTMLgrab(ourData);
        };
        ourRequest.send();
         function renderHTMLgrab(data) {
            timescale = data.timescale;
            firstStatement = data.string1;
            secondStatement = data.string2;
            if(timescale == "week")
                changer('https://api.myjson.com/bins/tm4ub');
            else if(timescale == "month")
                 changer('https://api.myjson.com/bins/7no1v');
            else if(timescale == "year")
                changer('https://api.myjson.com/bins/pxobn');
          }
    }

    function changer(url){
        var ourRequest = new XMLHttpRequest();
        ourRequest.open('GET', url);
        ourRequest.onload = function() {
            var ourData = JSON.parse(ourRequest.responseText);
            console.log(ourData);
            renderHTML(ourData);
        };
        ourRequest.send();
        function renderHTML(data) {
            if(data.values.length == 7){
                timescale = "week";
                document.getElementById("timescaleTest").innerHTML = timescale;
                document.getElementById("queryTest").innerHTML = urlBase + timescale;
                drawWeekPanels(data);
            }
            else if (data.values.length == 12){
                timescale = "year";
                document.getElementById("timescaleTest").innerHTML = timescale;
                document.getElementById("queryTest").innerHTML = urlBase + timescale;
                drawYearPanels(data);
            }
            else if (data.values.length == 31){
                timescale = "month";
                document.getElementById("timescaleTest").innerHTML = timescale;
                document.getElementById("queryTest").innerHTML = urlBase + timescale;
                drawMonthPanels(data);
            }
        }
     }


function weatherAPItest(url){
        var ourRequest = new XMLHttpRequest();
        ourRequest.open('GET', url);
        ourRequest.onload = function() {
            var ourData = JSON.parse(ourRequest.responseText);
            console.log(ourData);
            renderHTML(ourData);
        };
        ourRequest.send();
        function renderHTML(data) {
        var weatherId = data.weather[0].id;
        var seconds = new Date() / 1000;
        if(weatherId < 300)
          weatherImage = "img/thunderstorm.png";
        else if(weatherId < 600)
          weatherImage = "img/raining.png";
        else if(weatherId < 700)
          weatherImage = "img/snowing.png";
        else if(weatherId == 800){
              if((seconds < data.sys.sunrise) || (seconds > data.sys.sunset))
                  weatherImage = "img/moon.png";
              else
                weatherImage = "img/sunny.png";
        }
        else if(weatherId < 803)
          weatherImage = "img/partlyCloudy.png";
        else
          weatherImage = "img/cloudy.png";

        $("#weatherPic").html(" <img src=" + weatherImage + ' style="height:23vh"> ');
        $("#weatherTemp").html(Math.round(data.main.temp) + " &#176;&nbsp;");
        }

     }
//////////////////////////////////////////
//Drawing Functions for the 3 timeframes//
//Must clear chart and gauge each time  //
//COMBINE INTO ONE FUNCTION LATER       //
//////////////////////////////////////////

    //updating page if timeframe is a week
    function drawWeekPanels(incomingData){
        //clearing guage and chart panels before writing new data
        $('#gauge').empty();
        $('#chart_div').empty();

        //loading in new week data for chart
        for(i = 0; i < 7; i++)
            weekChart[i+1][1] = parseInt(incomingData.values[i]);

        //creating new chart
        drawChart(weekChart);

        //drawing new gauge
        drawGauge(parseInt(incomingData.percentage));

        //updating analogy statements
        //firstStatement = incomingData.firstStatement;
        //seco+
        ndStatement = incomingData.secondStatement;

        //writing new analogy sentenc
        document.getElementById("enAnalogy").innerHTML = firstStatement + " " + parseInt(incomingData.energyAnalogyValue) + " " + secondStatement;

        //writing new cost sentence
        document.getElementById("cost").innerHTML = "$" + parseInt(incomingData.moneySaved) + " of energy was produced in the last week";
     }



    //updating page if timeframe is a month
    function drawMonthPanels(incomingData){
        //clearing guage and chart panels before writing new data
        $('#gauge').empty();
        $('#chart_div').empty();

        //loading in new week data for chart
        for(i = 0; i < 31; i++)
            monthChart[i+1][1] = parseInt(incomingData.values[i]);

        //creating new chart
        drawChart(monthChart);

        //drawing new gauge
        drawGauge(parseInt(incomingData.percentage));

        //writing new analogy sentence
        document.getElementById("enAnalogy").innerHTML = firstStatement + " " + parseInt(incomingData.energyAnalogyValue) + " " + secondStatement;

        //writing new cost sentence
        document.getElementById("cost").innerHTML = "$" + parseInt(incomingData.moneySaved) + " of energy was produced in the last month";
     }



    //updating page if timeframe is a year
    function drawYearPanels(incomingData){
        //clearing guage and chart panels before writing new data
        $('#gauge').empty();
        $('#chart_div').empty();

        //loading in new week data for chart
        for(i = 0; i < 12; i++)
            yearChart[i+1][1] = parseInt(incomingData.values[i]);

        //creating new chart
        drawChart(yearChart);

        //drawing new gauge
        drawGauge(parseInt(incomingData.percentage));

        //writing new analogy sentenc
        document.getElementById("enAnalogy").innerHTML = firstStatement + " " + parseInt(incomingData.energyAnalogyValue) + " " + secondStatement;

        //writing new cost sentence
        document.getElementById("cost").innerHTML = "$" + parseInt(incomingData.moneySaved) + " of energy was produced in the last year";
     }

</script>
</body>
</html>